---
layout: post
title: "DataStructure_中缀表达式求值问题"
date: 2019-10-24 19:42:44
image: "/assets/img/DS/"
description: "中缀表达式求值问题"
tags:
    - Data Structure作业
categories:
    - Data Structure
---

题目背景：

项目内容：

​ 从键盘上输入中缀算数表达式，包括括号，计算出表达式的值。

项目要求：

1 程序对所有输入的表达式作简单的判断，如表达式有错，能给出适当的提示。支持包括加减，乘除取余，乘方和括号等操作符，其中优先级是等于<括号<加减<乘除取余<乘方

2 能处理单目运算符：+或-。

项目测试用例：

输入表达式：

-2\*(3+5)+2^3/4=

-14

是否继续（y，n）？y

输入表达式：

2^4/8-(+2+8)%3=

1

是否继续（y，n）？n

## 一、分析

### 1.1 项目背景分析

平时我们使用的运算表达式就是中缀表达式，例如**1+3\*2**，中缀表达式的特点就是：**二元运算符总是置于与之相关的两个运算对象之间**。这种表达式人读起来比较好理解，但是计算机处理起来就很麻烦，运算顺序往往因表达式的内容而定，不具规律性。所以为了方便计算机求解中缀表达式的值，我们考虑将中缀表达式转换成计算机容易理解的格式，再进行表达式的求值运算。

### 1.2 项目功能要求

相比于中缀表达式，明显具有计算优势的一种表达式是后缀表达式（又名逆波兰表达式）。后缀表达式的特点就是：每一运算符都置于其运算对象之后，且表达式中不含有括号，运算符的顺序与计算顺序相关，以上面的中缀表达式**1+2\*3**为例子，转为后缀表达式就是**123\*+**。对于生成的后缀表达式，我们可以很容易的根据读取的运算符进行对运算符之前的数字的计算求值。

## 二、设计

### 2.1 整体系统设计

由分析得，我们主要需要进行的操作是

​ **1. 将中缀表达式转化为后缀表达式**，

​ **2. 求后缀表达式的值**

但因为不是所有的表达式都是由简单的个位数配合双目运算符组成，除了题中所给出的单目运算符存在，本题还需要处理一个步骤：

​ **0. 将中缀表达式进行预处理**

​ 其中，需要特别处理的有以下部分：

​ **1. 前置单目运算符“+”、“-”的处理**

​ **2. 多位数的处理**

​ **3. 小数的处理(包含对小数做取余运算时的取整处理)**

对于预处理后的中缀表达式，将其转化成后缀表达式，有两种常见方法。我们在数据结构课程上有学到，对于一个二叉树，如果它的叶节点存放的是数字，其余节点存放操作符的话，那么这个二叉树的中序遍历序列会得到一个中缀表达式（需在某些地方手动添加括号使表达式逻辑正确），相应的，该二叉树的前序遍历序列对应该算术表达式的前缀表达式，后序遍历序列对应后缀表达式。以表达式**3×5+5÷2+(3+5)×2**为例，将其表示成二叉树形式，如下图所示：

<img src="https://drive.google.com/uc?export=view&amp;id=1wR-MK17mWAAnw6yypNF6rEzbaoaFGtrI" alt="img" style="zoom:50%;" />

将中缀表达式表示为二叉树形式的过程如下：

1. 找出表达式中最后进行运算的操作符，即优先级最低的操作符，作为根节点
2. 在步骤 1 找出的操作符的左侧部分找出最后进行运算的操作符，作为步骤 1 根节点的左子节点；右侧部分进行同样的操作
3. 若步骤 1 找出的操作符左侧或右侧部分只含有操作数，不含有操作符，则将该操作数作为对应的叶子节点。
4. 不断重复上述过程直到二叉树包含表达式的所有操作数和操作符

建立完毕表达式的二叉树，从叶子节点开始对二叉树进行后序遍历（左子树 -> 右子树 -> 根节点），即可得到中缀表达式对应的后缀表达式。

而二叉树的遍历分为递归法与非递归法，对于二叉树的中序遍历和后序遍历，我们都可以用**栈（Stack）**这种数据结构来实现二叉树的非递归遍历。同样的，为了方便表达式的转化，我们可以直接只用栈来实现中缀表达式转化为后缀表达式，从而避免二叉树的构建。该过程与计算中缀表达式的过程类似，使用一个栈保存操作符，一个队列结构用于保存转换得到的后缀表达式。其过程如下：

1. 从头到尾扫描表达式，若遇到操作符，则与操作符栈的栈顶元素比较优先级：如果当前操作符优先级高于栈顶元素的优先级，则压入操作符栈；否则不断弹出操作符栈顶元素压入结果队列，直到栈顶元素的优先级低于当前操作符的优先级，将当前操作符压入操作符栈
2. 若遇到操作数，则直接压入结果队列
3. 若遇到左括号，则压入操作符栈
4. 若遇到右括号，则依次弹出操作符栈顶元素压入结果队列，直到遇到左括号，将左括号弹出操作符栈

对于后缀表达式的计算，实现思路是：

1. 如果是操作数，那么将其压入“结果栈”中
2. 如果是操作符，从“结果栈”中取出两个元素，进行计算。（注意从栈中取元素的顺序和操作数的顺序是相反的）
   遍历后缀表达式结束后，“结果栈”中的元素就是最终的结果。

### 2.2 数据结构设计

栈(stack)是存放数据对象的一种特殊容器，其中的数据元素按线性的逻辑次序排列，故也可定义首、末元素。不过，尽管栈结构也支持对象的插入和删除操作，但其操作的范围仅限于栈的某一特定端。也就是说，若约定新的元素只能从某一端插入其中，则反过来也只能从这一端删除已有的元素。禁止操作的另一端，称作盲端。

作为抽象数据类型，栈需要的常用操作有元素的入栈、栈顶元素的出栈以及返回栈顶元素的值。栈实现可以基于单向链表：设置一个哨兵头节点，每次入栈操作相当于在头节点后插入一个新节点，出栈则删除头节点后的节点。

由于本题需要用到多种数据类型的栈结构，所以数据结构由模板类实现。

## 三、实现

### 3.1 单目运算符预处理

#### 1. 预处理流程图流程图及说明

![001.png](https://github.com/Xuedixuedi/Xuedixuedi.github.io/blob/master/assets/img/DS/001.png?raw=true)

### 3.2 中缀表达式转化为后缀表达式

#### 1. 转化流程图及说明

![002.png](https://github.com/Xuedixuedi/Xuedixuedi.github.io/blob/master/assets/img/DS/002.png?raw=true)

### 3.3 后缀表达式求值的实现

#### 1. 求值示意图及说明

![003.png](https://github.com/Xuedixuedi/Xuedixuedi.github.io/blob/master/assets/img/DS/003.png?raw=true)

特别需要注意的是，由于栈这种数据结构遵循**后进先出**的原则，所以对于从栈顶取出的两个数字进行二元运算时，应注意运算数的排列顺序。
